`timescale 1ns / 1ps
//////////////////////////////////////////////////////////////////////////////////
// Company: 
// Engineer: 
// 
// Create Date: 11/19/2025 06:24:39 PM
// Design Name: 
// Module Name: im
// Project Name: 
// Target Devices: 
// Tool Versions: 
// Description: 
// 
// Dependencies: 
// 
// Revision:
// Revision 0.01 - File Created
// Additional Comments:
// 
//////////////////////////////////////////////////////////////////////////////////

module im(
    input wire [31:0] address,     
    output reg [31:0] instruction  
);
    parameter MEM_SIZE = 256;

    reg [31:0] mem [0:MEM_SIZE-1];

always @(*) begin
        if (address >= 0 && address < MEM_SIZE) begin
            instruction = mem[address];
        end else begin
            instruction = 32'h00000000; 
        end
    end

integer i;
    initial begin
        for (i = 0; i < MEM_SIZE; i = i + 1) begin
            mem[i] = 32'h00000000;
        end
        // Format: y(10)|rd(6)|rs(6)|rt(6)|opcode(4)
        // Based on CSEN 122 reference, converted from opcode|rt|rs|rd|y to y|rd|rs|rt|opcode
        
        // Initialization
        mem[0] = 32'b0000000000_001111_001111_001111_0111; // SUB x15,x15,x15 (create 0)
        mem[1] = 32'b0000000001_001110_001111_000000_0101; // INC x14,x15,1 (create 1)
        mem[2] = 32'b0000000000_000101_000011_001110_0111; // SUB x5,x3,x14 (N-1)
        mem[3] = 32'b0000000000_001000_000001_000000_1110; // LD x8,x1,0 (a[0])
        mem[4] = 32'b0000000000_000000_000000_000000_0000; // NOP (load delay)
        mem[5] = 32'b0000000000_000000_000000_000000_0000; // NOP
        mem[6] = 32'b0000000000_000000_000010_001000_0011; // ST x8,x2,0 (b[0])
        mem[7] = 32'b0000000000_000110_000001_000101_0100; // ADD x6,x1,x5 (a[N-1] addr)
        mem[8] = 32'b0000000000_000111_000010_000101_0100; // ADD x7,x2,x5 (b[N-1] addr)
        mem[9] = 32'b0000000000_001000_000110_000000_1110; // LD x8,x6,0 (a[N-1])
        mem[10] = 32'b0000000000_000000_000000_000000_0000; // NOP (load delay)
        mem[11] = 32'b0000000000_000000_000000_000000_0000; // NOP
        mem[12] = 32'b0000000000_000000_000111_001000_0011; // ST x8,x7,0 (b[N-1])
        mem[13] = 32'b0000000001_000100_001111_000000_0101; // INC x4,x15,1 (i=1)
        mem[14] = 32'b0000110011_010101_000000_000000_1111; // SVPC x21,51 (LOOP_END: 65-14=51)
        mem[15] = 32'b0000000110_010110_000000_000000_1111; // SVPC x22,6 (LOAD_VALS: 21-15=6)
        mem[16] = 32'b0000000001_010100_000000_000000_1111; // SVPC x20,1 (LOOP_START: 17-16=1)
        
        // Main loop
        mem[17] = 32'b0000000000_001101_000100_000101_0111; // LOOP_START: SUB x13,x4,x5 (check i<N-1)
        mem[18] = 32'b0000000000_000000_000000_000000_0000; // NOP (flag delay)
        mem[19] = 32'b0000000000_000000_010110_000000_1010; // BRN x22 (to LOAD_VALS) - target in rs
        mem[20] = 32'b0000000000_000000_010101_000000_1000; // J x21 (to LOOP_END) - target in rs
        
        // Load 3-element window
        mem[21] = 32'b0000000000_000000_000000_000000_0000; // LOAD_VALS: NOP (iteration bubble)
        mem[22] = 32'b0000000000_001011_000100_001110_0111; // SUB x11,x4,x14 (i-1)
        mem[23] = 32'b0000000000_001011_000001_001011_0100; // ADD x11,x1,x11
        mem[24] = 32'b0000000000_001000_001011_000000_1110; // LD x8,x11,0 (a[i-1])
        mem[25] = 32'b0000000000_000110_000001_000100_0100; // ADD x6,x1,x4
        mem[26] = 32'b0000000000_001001_000110_000000_1110; // LD x9,x6,0 (a[i])
        mem[27] = 32'b0000000000_001100_000100_001110_0100; // ADD x12,x4,x14 (i+1)
        mem[28] = 32'b0000000000_001100_000001_001100_0100; // ADD x12,x1,x12
        mem[29] = 32'b0000000000_001010_001100_000000_1110; // LD x10,x12,0 (a[i+1])
        
        // SWAP1: compare x8 and x9
        mem[30] = 32'b0000000000_001101_001000_001001_0111; // SUB x13,x8,x9
        mem[31] = 32'b0000000000_000000_000000_000000_0000; // NOP (flag delay)
        mem[32] = 32'b0000001000_010111_000000_000000_1111; // SVPC x23,8 (NO_SWAP_1: 40-32=8)
        mem[33] = 32'b0000000000_000000_000000_000000_0000; // NOP (SVPC WB delay 1)
        mem[34] = 32'b0000000000_000000_000000_000000_0000; // NOP (SVPC WB delay 2)
        mem[35] = 32'b0000000000_000000_010111_000000_1010; // BRN x23 (if x8<x9, no swap) - target in rs
        mem[36] = 32'b0000000000_000000_010111_000000_1001; // BRZ x23 (if x8==x9, no swap) - target in rs
        mem[37] = 32'b0000000000_001101_001000_001111_0100; // ADD x13,x8,x15 (swap: temp=x8)
        mem[38] = 32'b0000000000_001000_001001_001111_0100; // ADD x8,x9,x15 (x8=x9)
        mem[39] = 32'b0000000000_001001_001101_001111_0100; // ADD x9,x13,x15 (x9=temp)
        
        // SWAP2: compare x9 and x10
        mem[40] = 32'b0000000000_001101_001001_001010_0111; // NO_SWAP_1: SUB x13,x9,x10
        mem[41] = 32'b0000000000_000000_000000_000000_0000; // NOP (flag delay)
        mem[42] = 32'b0000001000_011000_000000_000000_1111; // SVPC x24,8 (NO_SWAP_2: 50-42=8)
        mem[43] = 32'b0000000000_000000_000000_000000_0000; // NOP (SVPC WB delay 1)
        mem[44] = 32'b0000000000_000000_000000_000000_0000; // NOP (SVPC WB delay 2)
        mem[45] = 32'b0000000000_000000_011000_000000_1010; // BRN x24 (if x9<x10, no swap) - target in rs
        mem[46] = 32'b0000000000_000000_011000_000000_1001; // BRZ x24 (if x9==x10, no swap) - target in rs
        mem[47] = 32'b0000000000_001101_001001_001111_0100; // ADD x13,x9,x15 (swap: temp=x9)
        mem[48] = 32'b0000000000_001001_001010_001111_0100; // ADD x9,x10,x15 (x9=x10)
        mem[49] = 32'b0000000000_001010_001101_001111_0100; // ADD x10,x13,x15 (x10=temp)
        
        // SWAP3: compare x8 and x9 again
        mem[50] = 32'b0000000000_001101_001000_001001_0111; // NO_SWAP_2: SUB x13,x8,x9
        mem[51] = 32'b0000000000_000000_000000_000000_0000; // NOP (flag delay)
        mem[52] = 32'b0000001000_011001_000000_000000_1111; // SVPC x25,8 (NO_SWAP_3: 60-52=8)
        mem[53] = 32'b0000000000_000000_000000_000000_0000; // NOP (SVPC WB delay 1)
        mem[54] = 32'b0000000000_000000_000000_000000_0000; // NOP (SVPC WB delay 2)
        mem[55] = 32'b0000000000_000000_011001_000000_1010; // BRN x25 (if x8<x9, no swap) - target in rs
        mem[56] = 32'b0000000000_000000_011001_000000_1001; // BRZ x25 (if x8==x9, no swap) - target in rs
        mem[57] = 32'b0000000000_001101_001000_001111_0100; // ADD x13,x8,x15 (swap: temp=x8)
        mem[58] = 32'b0000000000_001000_001001_001111_0100; // ADD x8,x9,x15 (x8=x9)
        mem[59] = 32'b0000000000_001001_001101_001111_0100; // ADD x9,x13,x15 (x9=temp)
        
        // Store median and loop back
        mem[60] = 32'b0000000000_000000_000000_000000_0000; // NO_SWAP_3: NOP (delay)
        mem[61] = 32'b0000000000_000111_000010_000100_0100; // ADD x7,x2,x4 (b[i] addr)
        mem[62] = 32'b0000000000_000000_000111_001001_0011; // ST x9,x7,0 (store median)
        mem[63] = 32'b0000000001_000100_000100_000000_0101; // INC x4,x4,1 (i++)
        mem[64] = 32'b0000000000_000000_010100_000000_1000; // J x20 (to LOOP_START) - target in rs
        
        // Loop end
        mem[65] = 32'b0000000000_000000_000000_000000_0000; // LOOP_END: NOP
        mem[66] = 32'b0000000000_000000_000000_000000_0000; // NOP
    end
endmodule
